<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Cdn on Sajal Kayan</title>
    <link>https://www.sajalkayan.com/tag/cdn.xml</link>
    <description>Recent content in Cdn on Sajal Kayan</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <atom:link href="https://www.sajalkayan.com/tag/cdn.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Using Cloudflare&#39;s 1.1.1.1 might lead to slower CDN performance</title>
      <link>https://www.sajalkayan.com/post/cloudflare-1dot1dot1dot1.html</link>
      <pubDate>Sat, 21 Apr 2018 17:46:45 +0000</pubDate>
      
      <guid>https://www.sajalkayan.com/post/cloudflare-1dot1dot1dot1.html</guid>
      <description>&lt;p&gt;&lt;strong&gt;Disclaimer: All views expressed here are personal&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Recently Cloudflare launched their &lt;a href=&#34;https://1.1.1.1/&#34;&gt;1.1.1.1&lt;/a&gt; public resolver in partnership with APNIC to great fan-fare boasting  performance improvements and increased privacy.&lt;/p&gt;

&lt;p&gt;While their claims are true, I would like to talk about them &lt;a href=&#34;https://developers.cloudflare.com/1.1.1.1/nitty-gritty-details/#edns-client-subnet&#34;&gt;not forwarding&lt;/a&gt; &lt;a href=&#34;https://tools.ietf.org/html/rfc7871&#34;&gt;EDNS client subnet&lt;/a&gt;(ECS). &lt;a href=&#34;https://www.quad9.net/&#34;&gt;Quad9&lt;/a&gt; does something similar, but provide an &lt;a href=&#34;https://www.quad9.net/faq/#Is_there_a_service_that_Quad9_offers_that_does_not_have_the_blocklist_or_other_security&#34;&gt;ECS capable IP&lt;/a&gt; hidden in the docs for users who really care about performance.&lt;/p&gt;

&lt;p&gt;In 2010 I &lt;a href=&#34;https://www.sajalkayan.com/in-a-cdnd-world-opendns-is-the-enemy.html&#34;&gt;wrote a post&lt;/a&gt; outlining how using public DNS resolvers leads to degraded performance when accessing non-anycast CDNs. We have come a long way since then, with EDNS Client Subnet being supported by most public resolvers, and a wider pop footprint, that blogpost is very outdated.&lt;/p&gt;

&lt;p&gt;According to Cloudflare&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;1.1.1.1 is a privacy centric resolver so it does not send any client IP information and does not send the EDNS Client Subnet Header to authoritative servers&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;If I do a DNS lookup for &lt;code&gt;cdn.example.com&lt;/code&gt;, it is with the intent of connecting to that website(over HTTP/HTTPS/TCP/whatever). The concern appears to be the CDN&amp;rsquo;s authoritative DNS service provider being able to see the subnet of the end user. Sure that is one way some information about the user could &lt;em&gt;leak&lt;/em&gt;. But /24 is not a strong indicator to identify specific user.&lt;/p&gt;

&lt;p&gt;When I do make the final connection, I am sending my whole /32 IP address. The /24 (or /28) that would have been sent is hardly any privacy concern compared to the exact IP that&amp;rsquo;s needed to be exposed while making a TCP connection.&lt;/p&gt;

&lt;p&gt;While visiting a typical website, A user exposes their full IP to potentially following parties&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;The website&amp;rsquo;s server&lt;/li&gt;
&lt;li&gt;The website&amp;rsquo;s loadbalancer (if any - Like AWS ELB, digital ocean, etc)&lt;/li&gt;
&lt;li&gt;The website&amp;rsquo;s hosting provider (AWS, DO, Google, etc etc&amp;hellip;)&lt;/li&gt;
&lt;li&gt;1 - 3 for all 3rd party objects on the webpage (including their CDNs).&lt;/li&gt;
&lt;li&gt;All network devices sitting in between 1 - 4&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Authoritative DNS service provider is just another piece of a website&amp;rsquo;s hosting infrastructure, which with ECS only gets partial IP. Sending partial IP, IMHO, is a very trivial privacy concern in comparison to the potential benefits.&lt;/p&gt;

&lt;p&gt;For a non-anycast CDN, to get accurate DNS-based routing from user of 1.1.1.1, the following must work flawlessly.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Internal POP IP of Cloudflare must be very accurate in geoip databases like MaxMind and friends.&lt;/li&gt;
&lt;li&gt;The user must always be routed to closest Cloudflare POP. If for some reason the path is wrong, then along with slower Cloudflare, users will experience slower all-CDNs.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;But&amp;hellip; Doesn&amp;rsquo;t Cloudflare have POPs &lt;a href=&#34;https://www.cloudflare.com/network/&#34;&gt;almost everywhere&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;Yes. But that only gives somewhat geographical granularity. What about ISP-level optimizations. I would like to only send users on Verizon from San Francisco to my Verizon POP. If that user uses 1.1.1.1, they don&amp;rsquo;t benefit from all the money I spent in setting up that POP. If another CDN has more locations than Cloudflare, then for a 1.1.1.1 user the CDN has to limit their service based on Cloudflare&amp;rsquo;s network map. CDNs who host closer to the Edge are impacted more than ones who host at hubs.&lt;/p&gt;

&lt;p&gt;Some tests using &lt;a href=&#34;https://github.com/turbobytes/dnsperfbench&#34;&gt;dnsperfbench&lt;/a&gt; tool&amp;rsquo;s &lt;a href=&#34;https://github.com/turbobytes/dnsperfbench/blob/httptest/README.md#httptest&#34;&gt;httptest&lt;/a&gt; feature. Basically for each resolver it figures out what IP the resolver is returning for Akamai, and then running HTTPS tests over it.&lt;/p&gt;

&lt;p&gt;Choosing Akamai as the target of this test was an intentional selection bias on my end to highlight the issue at hand.&lt;/p&gt;

&lt;p&gt;From Thailand/&lt;a href=&#34;https://www.ais.co.th/fibre/en/&#34;&gt;AIS Fiber&lt;/a&gt; (first hop adds ~20ms latency!)&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ dnsperfbench -resolver 115.178.58.10 -httptest https://turbobytes.akamaized.net/static/rum/100kb-image.jpg
2018/04/21 20:09:47 Resolving
2018/04/21 20:10:00 Issuing HTTP(s) tests
&lt;/code&gt;&lt;/pre&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;RESOLVER&lt;/th&gt;
&lt;th&gt;REMOTE&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;DNS&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;CONNECT&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;TLS&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;TTFB&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;TRANSFER&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;TOTAL&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;115.178.58.10&lt;/code&gt; (Unknown)&lt;/td&gt;
&lt;td&gt;49.231.112.9:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;26ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;23ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;83ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;25ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;40ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;197ms&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;9.9.9.9&lt;/code&gt; (Quad9)&lt;/td&gt;
&lt;td&gt;202.183.253.10:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;56ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;25ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;89ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;26ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;43ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;238ms&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;208.67.222.222&lt;/code&gt; (OpenDNS)&lt;/td&gt;
&lt;td&gt;49.231.112.33:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;71ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;23ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;83ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;25ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;40ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;242ms&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;8.8.8.8&lt;/code&gt; (Google)&lt;/td&gt;
&lt;td&gt;49.231.112.9:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;110ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;24ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;84ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;24ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;40ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;281ms&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;[2001:4860:4860::8888]&lt;/code&gt; (Google)&lt;/td&gt;
&lt;td&gt;49.231.112.33:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;111ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;24ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;83ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;24ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;41ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;282ms&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;[2620:0:ccc::2]&lt;/code&gt; (OpenDNS)&lt;/td&gt;
&lt;td&gt;49.231.112.33:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;156ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;24ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;82ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;24ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;40ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;326ms&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;[2606:4700:4700::1111]&lt;/code&gt; (Cloudflare)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;23.49.60.192:443&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;53ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;53ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;114ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;53ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;69ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;&lt;strong&gt;342ms&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;1.1.1.1&lt;/code&gt; (Cloudflare)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;23.49.60.192:443&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;54ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;56ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;120ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;57ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;72ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;&lt;strong&gt;358ms&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;199.85.126.20&lt;/code&gt; (Norton)&lt;/td&gt;
&lt;td&gt;23.52.171.99:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;89ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;62ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;130ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;60ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;85ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;426ms&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;180.76.76.76&lt;/code&gt; (Baidu)&lt;/td&gt;
&lt;td&gt;23.2.16.27:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;129ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;86ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;180ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;86ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;123ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;605ms&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;[2620:fe::fe]&lt;/code&gt; (Quad9)&lt;/td&gt;
&lt;td&gt;23.215.102.26:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;27ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;223ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;456ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;224ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;317ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1.247s&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;[2a0d:2a00:1::]&lt;/code&gt; (Clean Browsing)&lt;/td&gt;
&lt;td&gt;23.219.38.67:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;350ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;228ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;465ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;229ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;278ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1.55s&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;185.228.168.168&lt;/code&gt; (Clean Browsing)&lt;/td&gt;
&lt;td&gt;23.219.38.48:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;382ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;227ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;463ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;227ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;292ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1.591s&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;119.29.29.29&lt;/code&gt; (DNSPod)&lt;/td&gt;
&lt;td&gt;205.197.140.136:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;474ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;236ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;481ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;244ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;335ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1.772s&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;114.114.114.114&lt;/code&gt; (114dns)&lt;/td&gt;
&lt;td&gt;23.215.104.203:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;382ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;283ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;573ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;284ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;401ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1.924s&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;8.26.56.26&lt;/code&gt; (Comodo)&lt;/td&gt;
&lt;td&gt;104.86.110.154:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;219ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;280ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;566ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;279ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;648ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1.993s&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;The fastest responding IP &lt;code&gt;49.231.112.x&lt;/code&gt; is hosted inside my ISP, next best is in another ISP in Thailand. If I were to use &lt;code&gt;1.1.1.1&lt;/code&gt; my access to things hosted with Akamai would get about 2x slower, in exchange for Akamai not getting to see my (partial) IP during DNS resolution.&lt;/p&gt;

&lt;p&gt;Sure, Cloudflare&amp;rsquo;s DNS service (which appears to be serving locally within this ISP) is new, perhaps Akamai has not updated their geoip databases with Cloudflare&amp;rsquo;s backend IPs, perhaps Cloudflare has not yet published them, but even with that fix, the best Akamai could do is send me to a &lt;em&gt;generic&lt;/em&gt; Thailand POP, instead of the one sitting at my ISP.&lt;/p&gt;

&lt;p&gt;Similarly for Thailand/&lt;a href=&#34;http://www.trueinternet.co.th/ENG/index.html&#34;&gt;True&lt;/a&gt;&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;RESOLVER&lt;/th&gt;
&lt;th&gt;REMOTE&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;DNS&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;CONNECT&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;TLS&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;TTFB&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;TRANSFER&lt;/th&gt;
&lt;th align=&#34;right&#34;&gt;TOTAL&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code&gt;203.144.206.49&lt;/code&gt; (Unknown)&lt;/td&gt;
&lt;td&gt;61.91.165.154:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;15ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;29ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;15ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;80ms&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;9.9.9.9&lt;/code&gt; (Quad9)&lt;/td&gt;
&lt;td&gt;202.183.253.8:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;13ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;11ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;57ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;12ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;16ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;109ms&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;8.8.8.8&lt;/code&gt; (Google)&lt;/td&gt;
&lt;td&gt;61.91.165.154:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;97ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;10ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;29ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;11ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;17ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;163ms&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;208.67.222.222&lt;/code&gt; (OpenDNS)&lt;/td&gt;
&lt;td&gt;61.91.165.154:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;105ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;9ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;29ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;11ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;15ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;169ms&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;199.85.126.20&lt;/code&gt; (Norton)&lt;/td&gt;
&lt;td&gt;203.116.50.51:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;66ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;43ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;105ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;43ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;46ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;303ms&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;1.1.1.1&lt;/code&gt; (Cloudflare)&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;184.86.250.8:443&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;36ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;67ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;144ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;66ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;110ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;&lt;strong&gt;423ms&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;180.76.76.76&lt;/code&gt; (Baidu)&lt;/td&gt;
&lt;td&gt;23.2.16.32:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;72ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;84ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;181ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;84ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;114ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;535ms&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;119.29.29.29&lt;/code&gt; (DNSPod)&lt;/td&gt;
&lt;td&gt;23.42.156.42:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;70ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;90ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;187ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;90ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;103ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;542ms&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;8.26.56.26&lt;/code&gt; (Comodo)&lt;/td&gt;
&lt;td&gt;104.86.110.185:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;225ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;220ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;442ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;221ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;312ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1.421s&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;185.228.168.168&lt;/code&gt; (Clean Browsing)&lt;/td&gt;
&lt;td&gt;80.239.137.26:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;212ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;225ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;464ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;229ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;507ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1.636s&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td&gt;&lt;code&gt;114.114.114.114&lt;/code&gt; (114dns)&lt;/td&gt;
&lt;td&gt;23.215.104.225:443&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;264ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;259ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;527ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;260ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;610ms&lt;/td&gt;
&lt;td align=&#34;right&#34;&gt;1.92s&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;In this case only Google, OpenDNS and ISP resolvers send me to an ISP-local POP. Quad9 came #2 because of their fast DNS time (this test does not use locally cached DNS).&lt;/p&gt;

&lt;p&gt;Cloudflare sends me to Singapore, and others further out.&lt;/p&gt;

&lt;p&gt;Cloudflare sending me Singapore IP might be due to the fact that for me &lt;code&gt;1.1.1.1&lt;/code&gt; is being routed to Cloudflare Singapore, probably True&amp;rsquo;s fault.&lt;/p&gt;

&lt;pre style=&#34;overflow-x:scroll;font-size:12px;white-space:pre&#34;&gt;
~# mtr --report-wide 1.1.1.1
Start: Sat Apr 21 21:05:43 2018
HOST: apu                                       Loss%   Snt   Last   Avg  Best  Wrst StDev
  1.|-- 192.168.2.1                                0.0%    10    1.2   1.1   0.9   1.2   0.0
  2.|-- 10.137.128.1                               0.0%    10   18.0  13.4  10.5  18.8   2.8
  3.|-- 10.246.253.133                             0.0%    10    8.8   8.3   6.3   9.7   0.9
  4.|-- 10.185.94.203                              0.0%    10    8.2   9.3   7.8  11.7   1.3
  5.|-- 10.185.94.25                               0.0%    10    9.2   9.4   7.5  15.1   2.1
  6.|-- 61-91-220-101.static.asianet.co.th         0.0%    10    8.3   9.2   7.8  10.2   0.5
  7.|-- 58-97-82-116.static.asianet.co.th          0.0%    10    8.6  10.2   8.5  13.4   1.4
  8.|-- ppp-171-102-254-65.revip18.asianet.co.th   0.0%    10    9.2   9.7   8.3  11.4   0.7
  9.|-- ppp-171-102-254-227.revip18.asianet.co.th  0.0%    10   11.5  10.6   8.9  15.9   2.0
 10.|-- 210-86-143-74.static.asianet.co.th         0.0%    10    9.8   9.3   8.0  10.8   0.7
 11.|-- TIG-Net242-108.trueintergateway.com        0.0%    10   10.6  11.8   9.8  16.5   1.9
 12.|-- TIG-Net245-241.trueintergateway.com        0.0%    10   39.7  40.5  38.5  47.6   2.5
 13.|-- 13335.sgw.equinix.com                      0.0%    10   41.8  38.2  36.5  44.5   2.6
 14.|-- 1dot1dot1dot1.cloudflare-dns.com           0.0%    10   35.3  37.4  35.3  40.0   1.2
&lt;/pre&gt;

&lt;p&gt;Dear Cloudflare, please turn on ECS by default.&lt;/p&gt;

&lt;p&gt;PS: Check out &lt;a href=&#34;https://ismydnsfast.com/&#34;&gt;ismydnsfast.com&lt;/a&gt; to check &lt;em&gt;your&lt;/em&gt; performance to major authoritative DNS providers.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>SimpleCDN goes down - a case for using multiple CDN providers</title>
      <link>https://www.sajalkayan.com/simplecdn-goes-down-a-case-for-using-multiple-cdn-providers.html</link>
      <pubDate>Sat, 11 Dec 2010 21:24:49 +0000</pubDate>
      
      <guid>https://www.sajalkayan.com/simplecdn-goes-down-a-case-for-using-multiple-cdn-providers.html</guid>
      <description>CDN provider &lt;a href=&#34;http://www.simplecdn.com/&#34;&gt;SimpleCDN&lt;/a&gt; has been down since last few days, with their customers venting their anger via online channels such as &lt;a href=&#34;http://search.twitter.com/search?q=SimpleCDN&#34;&gt;twitter&lt;/a&gt;.

To know more about what a CDN is, please read &lt;a href=&#34;https://www.sajalkayan.com/make-your-own-cheap-charlie-cdn.html&#34; title=&#34;Make your own cheap charlie CDN&#34;&gt;this post&lt;/a&gt;.

The reason given by them :-

&lt;blockquote&gt;&lt;em&gt;Dear SimpleCDN Customer,

I am writing this letter to update you on a situation that has been developing for the past 72 hours between SimpleCDN and our technology and infrastructure providers, SoftLayer and Hosting Services, Inc.

Two days ago these organizations decided to immediately terminate our contract and suspend service on much of our infrastructure in Dallas, Seattle and Washington, D.C. This infrastructure constitutes the majority of our delivery network for our value services, including on-demand and live streaming services. 

[...]&lt;/em&gt;&lt;/blockquote&gt;

Their full statement can be read at &lt;a href=&#34;http://admin.simplecdn.com/&#34;&gt;http://admin.simplecdn.com/&lt;/a&gt;. Quite likely this won&#39;t be the permanent url for their rant.

My first thought was that they didn&#39;t pay their bills.. but this &lt;a href=&#34;http://twitter.com/#!/SimpleCDN/status/13688306478882816&#34;&gt;doesn&#39;t seem&lt;/a&gt; to be the case here. I&#39;d speculate that this is related to DMCA or even some connection to Wikileaks. We need Softlayer&#39;s side of the story to make an opinion. I&#39;m a Softlayer user for few years, I refuse to believe it that they did it for competitive advantage. There is more to it!

MaxCDN has &lt;a href=&#34;http://blog.maxcdn.com/news/maxcdn-offers-easy-transition-for-stranded-simplecdn-customers/&#34; title=&#34;MaxCDN Offers Easy Transition for Stranded SimpleCDN Customers&#34;&gt;stepped in&lt;/a&gt; to help stranded SimpleCDN customers to get their sites up asap at lower costs.

So... let me be &lt;a href=&#34;http://www.youtube.com/watch?v=cY_oKve-bH0&#34;&gt;Captain Hindsight&lt;/a&gt; here and say what SimpleCDN users should have done all along.

&lt;strong&gt;Keep a hot spare CDN ready to be deployed at a moments notice.&lt;/strong&gt;

There are many CDN services, like &lt;a href=&#34;http://www.softlayer.com/cloudlayer/cdn/&#34;&gt;Softlayer&lt;/a&gt;, &lt;a href=&#34;http://aws.amazon.com/cloudfront/&#34;&gt;CloudFront&lt;/a&gt;, etc which have pay as you go plans, no upfront or monthly costs. Sign up for them, set up your zones, and keep the required CNAMEs handy. If your prime CDN provider goes under, has high latency, or any other issue, switching to these alternate CDNs is simply a change in the DNS zone. This could be automated with &lt;a href=&#34;http://aws.amazon.com/route53/&#34;&gt;Amazon Route 53&lt;/a&gt;.

Very easy to implement for origin pull, for uploaded content it doesn&#39;t hurt to store your content on multiple services for redundancy.

Had the users kept a hot spare CDN provider ready, it would have taken them 5 mins (plus the DNS propagation time) to switch to another provider.

In most cases, where only css, javascript, images are served by the CDN, frequent users such as admins would have these files in their browser cache and may not feel that anything is broken. For such situations, the answer is &lt;a href=&#34;http://blog.patrickmeenan.com/2010/08/passive-vs-active-performance.html&#34; title=&#34;Passive vs Active performance monitoring&#34;&gt;passive monitoring&lt;/a&gt;.

Bottomline: Everything FAILs.... eventually...

Notes:-
&lt;ul&gt;
    &lt;li&gt;This blog is hosted at softlayer&lt;/li&gt;
    &lt;li&gt;This blog uses MaxCDN&lt;/li&gt;
    &lt;li&gt;This blog uses Softlayer&#39;s CDN service&lt;/li&gt;
    &lt;li&gt;Before today i hadn&#39;t heard about SimpleCDN&lt;/li&gt;
&lt;/ul&gt;

&lt;strong&gt;UPDATED: 11:20 (EST) Dec 15&lt;/strong&gt;

The only 2 statements by SoftLayer on this issue comes in the form of tweets.

&lt;em&gt;FYI, our privacy policy prevents us from discussing customer issues in public. We definitely can&#39;t discuss customers of customers.&lt;/em&gt; - &lt;a href=&#34;http://twitter.com/#!/SoftLayer/status/14822398792564736&#34;&gt;twitter&lt;/a&gt;

&lt;em&gt;@simplecdn happy to have you as a direct customer. Send over your requirements so we can price it out for you. ^SK&lt;/em&gt; - &lt;a href=&#34;http://twitter.com/#!/SoftLayer/status/15059240414609408&#34;&gt;twitter&lt;/a&gt;

IMHO the second tweet is rubbing salt on SimpleCDN&#39;s wound.

It is common for companies under legal threat to not make any statements which may or maynot be used against them during litigation.

</description>
    </item>
    
    <item>
      <title>In a CDN&#39;d world, OpenDNS is the enemy!</title>
      <link>https://www.sajalkayan.com/in-a-cdnd-world-opendns-is-the-enemy.html</link>
      <pubDate>Mon, 17 May 2010 17:19:30 +0000</pubDate>
      
      <guid>https://www.sajalkayan.com/in-a-cdnd-world-opendns-is-the-enemy.html</guid>
      <description>While many people are happy with using DNS service providers such as OpenDNS, Google, etc... I will show you here why they may not produce optimal results.

The way most &lt;a href=&#34;http://www.cdnplanet.com/&#34;&gt;CDNs&lt;/a&gt; work is by using DNS routing. When a user attempts to resolve a hostname, the CDN&#39;s DNS server responds with an IP which is closest based on the IP address of the requester. A more detailed insight into the workings of a CDN can be found on an earlier post &#34;&lt;a href=&#34;https://www.sajalkayan.com/make-your-own-cheap-charlie-cdn.html&#34;&gt;Make your own cheap charlie CDN&lt;/a&gt;&#34;

For my test here, I tested from the following locations listed below :-
&lt;ol&gt;
	&lt;li&gt;&lt;a href=&#34;http://www.asianet.co.th/&#34;&gt;True&lt;/a&gt; - Thailand : My personal internet connection provided by the ISP called True Internet.&lt;/li&gt;
	&lt;li&gt;&lt;a href=&#34;http://www.softlayer.com/&#34;&gt;Softlayer&lt;/a&gt; - United States : A server hosted at Softlayer&#39;s Washington DC Datacenter.&lt;/li&gt;
	&lt;li&gt;&lt;a href=&#34;http://aws.amazon.com/ec2/&#34;&gt;EC2&lt;/a&gt; - United States : An EC2 instance at Amazons us-east-1c availability zone.&lt;/li&gt;
	&lt;li&gt;&lt;a href=&#34;http://aws.amazon.com/ec2/&#34;&gt;EC2-EU&lt;/a&gt; - Ireland : An EC2 instance at Amazons eu-west-1 availability zone. - Thanks &lt;a href=&#34;http://twitter.com/LukeInTH&#34;&gt;Luke&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&#34;http://aws.amazon.com/ec2/&#34;&gt;EC2-APAC&lt;/a&gt; - Singapore : An EC2 instance at Amazons ap-southeast-1a availability zone.&lt;/li&gt;
	&lt;li&gt;&lt;a href=&#34;http://www.comhem.se/&#34;&gt;Com Hem&lt;/a&gt; - Sweden : An ISP in sweden. - Thanks &lt;a href=&#34;http://twitter.com/nadam9&#34;&gt;Adam&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&#34;http://www.tataindicombroadband.in/&#34;&gt;Tata&lt;/a&gt; - India : An ISP in India. - Thanks &lt;a href=&#34;http://gaeatimes.com/&#34;&gt;Angsuman&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
The following DNS servers were used to resolve the domains :-
&lt;ol&gt;
	&lt;li&gt;&lt;a href=&#34;http://www.opendns.com/&#34;&gt;OpenDNS&lt;/a&gt; (208.67.222.222 , 208.67.220.220 )- Has different caches in multiple locations(Anycasted) - Chicago, Illinois, USA; Dallas, Texas, USA; Los Angeles, California, USA; Miami, Florida, USA; New York, New York, USA; Palo Alto, California, USA; Seattle, Washington, USA; Washington, DC, USA; Amsterdam, The Netherlands and London, England, UK&lt;/li&gt;
	&lt;li&gt;&lt;a href=&#34;http://code.google.com/speed/public-dns/&#34;&gt;Google Public DNS&lt;/a&gt; (8.8.8.8 , 8.8.4.4 ) - &#34;Google Public DNS servers are available worldwide&#34; . I think Google has their DNS servers in all countries where they have hosting infrastructure.&lt;/li&gt;
	&lt;li&gt;Local DNS - The ISP provided DNS in the different locations.&lt;/li&gt;
&lt;/ol&gt;
The test was done to the following CDN providers :-
&lt;ol&gt;
	&lt;li&gt;&lt;a href=&#34;http://www.internap.com/&#34;&gt;Internap&lt;/a&gt; ( cdn.thaindian.com ) - Uses DNS routing. POPs (Point Of Presence) in the following locations : Atlanta; Boston; Chicago; Dallas; Denver; El Segundo; Houston; Miami; New York; Philadelphia; Phoenix; San Jose; Seattle; Washington, DC; Sydney; Tokyo; Singapore; Hong Kong; Amsterdam; London&lt;/li&gt;
	&lt;li&gt;&lt;a href=&#34;http://www.akamai.com/&#34;&gt;Akamai&lt;/a&gt; ( profile.ak.fbcdn.net ) - AFAIK they have a POP in almost all countries including Thailand. Note: Akamai does not entertain sales queries from Thai companies.&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;Results:-&lt;/h3&gt;
1) &lt;strong&gt;Internap&lt;/strong&gt; ( using cdn.thaindian.com )
&lt;table style=&#34;font-size: 8pt;&#34; border=&#34;1&#34;&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;th&gt;Location&lt;/th&gt;
&lt;th colspan=&#34;2&#34;&gt;Opendns&lt;/th&gt;
&lt;th colspan=&#34;2&#34;&gt;Google&lt;/th&gt;
&lt;th colspan=&#34;2&#34;&gt;Local&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;IP Returned&lt;/th&gt;
&lt;th&gt;Ping to IP (ms)&lt;/th&gt;
&lt;th&gt;IP Returned&lt;/th&gt;
&lt;th&gt;Ping to IP (ms)&lt;/th&gt;
&lt;th&gt;IP Returned&lt;/th&gt;
&lt;th&gt;Ping to IP (ms)&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;True (Thailand)&lt;/th&gt;
&lt;td&gt;64.94.126.65&lt;/td&gt;
&lt;td&gt;256&lt;/td&gt;
&lt;td&gt;74.201.0.130&lt;/td&gt;
&lt;td&gt;365&lt;/td&gt;
&lt;td&gt;203.190.126.131&lt;/td&gt;
&lt;td style=&#34;background-color: #ccff99;&#34;&gt;152&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Softlayer (US-East Coast)&lt;/th&gt;
&lt;td&gt;69.88.152.250&lt;/td&gt;
&lt;td style=&#34;background-color: #ccff99;&#34;&gt;1.253&lt;/td&gt;
&lt;td&gt;74.201.0.130&lt;/td&gt;
&lt;td&gt;25.69&lt;/td&gt;
&lt;td&gt;69.88.152.250&lt;/td&gt;
&lt;td&gt;1.388&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;EC2 (US-East Coast)&lt;/th&gt;
&lt;td&gt;69.88.152.250&lt;/td&gt;
&lt;td&gt;2.144&lt;/td&gt;
&lt;td&gt;74.201.0.130&lt;/td&gt;
&lt;td&gt;20.229&lt;/td&gt;
&lt;td&gt;69.88.152.250&lt;/td&gt;
&lt;td style=&#34;background-color: #ccff99;&#34;&gt;2.094&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;EC2 (Europe)&lt;/th&gt;
&lt;td&gt;77.242.194.130&lt;/td&gt;
&lt;td&gt;13.331&lt;/td&gt;
&lt;td&gt;64.7.222.130&lt;/td&gt;
&lt;td&gt;159.422&lt;/td&gt;
&lt;td&gt;77.242.194.130&lt;/td&gt;
&lt;td style=&#34;background-color: #ccff99;&#34;&gt;12.504&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;EC2 (Singapore)&lt;/th&gt;
&lt;td&gt;64.94.126.65&lt;/td&gt;
&lt;td&gt;202&lt;/td&gt;
&lt;td&gt;74.201.0.130&lt;/td&gt;
&lt;td&gt;228&lt;/td&gt;
&lt;td&gt;202.58.12.98&lt;/td&gt;
&lt;td style=&#34;background-color: #ccff99;&#34;&gt;37.260&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Com Hem (Sweden)&lt;/th&gt;
&lt;td&gt;77.242.194.130&lt;/td&gt;
&lt;td&gt;40.035&lt;/td&gt;
&lt;td&gt;64.7.222.130&lt;/td&gt;
&lt;td&gt;189.647&lt;/td&gt;
&lt;td&gt;69.88.148.130&lt;/td&gt;
&lt;td style=&#34;background-color: #ccff99;&#34;&gt;36.310&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Tata (India)&lt;/th&gt;
&lt;td&gt;64.7.222.130&lt;/td&gt;
&lt;td&gt;313.2&lt;/td&gt;
&lt;td&gt;64.74.124.65&lt;/td&gt;
&lt;td&gt;304.1&lt;/td&gt;
&lt;td&gt;203.190.126.131&lt;/td&gt;
&lt;td style=&#34;background-color: #ccff99;&#34;&gt;150&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
2) &lt;strong&gt;Akamai&lt;/strong&gt; ( using profile.ak.fbcdn.net )
&lt;table style=&#34;font-size: 8pt;&#34; border=&#34;1&#34;&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;th&gt;Location&lt;/th&gt;
&lt;th colspan=&#34;2&#34;&gt;Opendns&lt;/th&gt;
&lt;th colspan=&#34;2&#34;&gt;Google&lt;/th&gt;
&lt;th colspan=&#34;2&#34;&gt;Local&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;IP Returned&lt;/th&gt;
&lt;th&gt;Ping to IP (ms)&lt;/th&gt;
&lt;th&gt;IP Returned&lt;/th&gt;
&lt;th&gt;Ping to IP (ms)&lt;/th&gt;
&lt;th&gt;IP Returned&lt;/th&gt;
&lt;th&gt;Ping to IP (ms)&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;True (Thailand)&lt;/th&gt;
&lt;td&gt;208.50.77.112&lt;/td&gt;
&lt;td&gt;239.4&lt;/td&gt;
&lt;td&gt;60.254.185.83&lt;/td&gt;
&lt;td&gt;138.9&lt;/td&gt;
&lt;td&gt;58.97.45.59&lt;/td&gt;
&lt;td style=&#34;background-color: #ccff99;&#34;&gt;18.88&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Softlayer (US-East Coast)&lt;/th&gt;
&lt;td&gt;72.246.31.57&lt;/td&gt;
&lt;td&gt;1.312&lt;/td&gt;
&lt;td&gt;72.246.31.42&lt;/td&gt;
&lt;td&gt;1.262&lt;/td&gt;
&lt;td&gt;24.143.196.88&lt;/td&gt;
&lt;td style=&#34;background-color: #ccff99;&#34;&gt;0.877&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;EC2 (US-East Coast)&lt;/th&gt;
&lt;td&gt;72.246.31.73&lt;/td&gt;
&lt;td&gt;2.581&lt;/td&gt;
&lt;td&gt;72.246.31.25&lt;/td&gt;
&lt;td style=&#34;background-color: #ccff99;&#34;&gt;1.792&lt;/td&gt;
&lt;td&gt;72.247.242.51&lt;/td&gt;
&lt;td&gt;1.941&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;EC2 (Europe)&lt;/th&gt;
&lt;td&gt;195.59.150.139&lt;/td&gt;
&lt;td style=&#34;background-color: #ccff99;&#34;&gt;13.449&lt;/td&gt;
&lt;td&gt;92.122.207.177&lt;/td&gt;
&lt;td&gt;29.022&lt;/td&gt;
&lt;td&gt;195.59.150.138&lt;/td&gt;
&lt;td&gt;13.516&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;EC2 (Singapore)&lt;/th&gt;
&lt;td&gt;208.50.77.94&lt;/td&gt;
&lt;td&gt;202&lt;/td&gt;
&lt;td&gt;60.254.185.73&lt;/td&gt;
&lt;td&gt;71.7&lt;/td&gt;
&lt;td&gt;124.155.222.10&lt;/td&gt;
&lt;td style=&#34;background-color: #ccff99;&#34;&gt;7.052&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Com Hem (Sweden)&lt;/th&gt;
&lt;td&gt;217.243.192.8&lt;/td&gt;
&lt;td&gt;51.73&lt;/td&gt;
&lt;td&gt;92.123.69.82&lt;/td&gt;
&lt;td&gt;35.972&lt;/td&gt;
&lt;td&gt;92.123.155.139&lt;/td&gt;
&lt;td style=&#34;background-color: #ccff99;&#34;&gt;13.212&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Tata (India)&lt;/th&gt;
&lt;td&gt;209.18.46.113&lt;/td&gt;
&lt;td&gt;300&lt;/td&gt;
&lt;td&gt;203.106.85.33&lt;/td&gt;
&lt;td&gt;196&lt;/td&gt;
&lt;td&gt;125.252.226.58&lt;/td&gt;
&lt;td style=&#34;background-color: #ccff99;&#34;&gt;100.5&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
The ping timings represent the lag to the destination server from the location in question. I will try to update the results from more locations if I can get shell access to a server or PC in other countries. If you are willing to run the tests for me please contact me(or post in comments)
&lt;h3&gt;Conclusion&lt;/h3&gt;
Using OpenDNS or Google Public DNS may be fast in resolving the DNS, but they do not give the ideal results.

In the case of Global DNS providers, the IP of the original requester is not passed along to the CDN&#39;s DNS servers so they are unable to route the user to the nearest POP.

As you can see in the result tables above, when using OpenDNS from Thailand, trying to access static assets of Facebook, I am directed to a server in the USA whereas when using Google&#39;s DNS i am directed to a server in Japan and when using my ISP&#39;s DNS server I access content locally, hosted within my own ISPs network!

While the effect on large websites using CDN is significant, smaller non-CDN&#39;d websites are also effected. Most websites embed widgets, advertising and other assets which are likely to be CDN&#39;d.

The solution would be to use your ISPs DNS server rather than these Global providers. If they really suck so bad, its fairly simple to set up BIND as a caching recursive resolver to resolve hostnames directly bypassing the ISPs crappy service.

&lt;a href=&#34;http://www.linkedin.com/in/billf&#34;&gt;Bill Fumerola&lt;/a&gt;, ex-director of network engineering at OpenDNS &lt;a href=&#34;http://forums.opendns.com/comments.php?DiscussionID=1096#Item_7&#34;&gt;confirms this problem&lt;/a&gt; on OpenDNS forums.

You can run the tests from your own computer using this simple script: &lt;a href=&#34;https://www.sajalkayan.com/dnstest.py&#34; target=&#34;_blank&#34;&gt;dnstest.py&lt;/a&gt;

Here is the named.conf for a recursive server. Set your computer to use 127.0.0.1 as the DNS. - config may differ for you, RTFM and adapt accordingly.
&lt;pre&gt;options {
        directory &#34;/var/named&#34;;
        listen-on {
		127.0.0.1;
        };
        auth-nxdomain yes;
        allow-recursion {
                127.0.0.1;
        };
        dump-file       &#34;/var/named/data/cache_dump.db&#34;;
        statistics-file &#34;/var/named/data/named_stats.txt&#34;;
        memstatistics-file &#34;/var/named/data/named_mem_stats.txt&#34;;

};

//
// a caching only nameserver config
//
zone &#34;.&#34; {
        type hint;
        file &#34;named.ca&#34;;
};

include &#34;/etc/named.rfc1912.zones&#34;;

include &#34;/etc/named.dnssec.keys&#34;;
include &#34;/etc/pki/dnssec-keys/dlv/dlv.isc.org.conf&#34;;&lt;/pre&gt;
EDIT 1: Inverted the axis added test data from Europe
EDIT 2: Added test data from Singapore
EDIT 3: Added test data from Sweden
EDIT 4: Added test data from India
EDIT 5: Added link to Bill Fumerola’s explanation of the problem.

&lt;h3&gt;Shameless plug&lt;/h3&gt;
&lt;a href=&#34;http://www.turbobytes.com/&#34;&gt;Turbobytes&lt;/a&gt; - Faster content delivery using multiple CDNs

</description>
    </item>
    
    <item>
      <title>Make your own cheap charlie CDN</title>
      <link>https://www.sajalkayan.com/make-your-own-cheap-charlie-cdn.html</link>
      <pubDate>Sat, 28 Jun 2008 05:26:21 +0000</pubDate>
      
      <guid>https://www.sajalkayan.com/make-your-own-cheap-charlie-cdn.html</guid>
      <description>&lt;a href=&#34;http://en.wikipedia.org/wiki/Content_Delivery_Network&#34; target=&#34;_self&#34;&gt;CDN&lt;/a&gt; stands for Content Delivery(or Distribution) Network. It is a network of servers usually located in various geographic locations to improve the availability and access speed of a website (or webapp or other media). The main use of CDNs were during the nineteens when inter-continental access was slow, scarce and expensive. Origin server could be in the silicon valley, users from UK would access the node located in UK, so in theory only once the page would be downloaded from the US server to the UK server. Thus allowing the UK visitors to access the page locally resulting in a huge saving in inter-continental bandwidth costs and improved access times for the end users.

CDNs are traditionally a very expensive solution to implement if using any of the &lt;a href=&#34;http://en.wikipedia.org/wiki/Content_Delivery_Network#Commercial_CDNs&#34;&gt;established providers&lt;/a&gt;. The solution in itself is not very complex. I am in the process of implementing my very own CDN. The benefits are simple.
&lt;ul&gt;
	&lt;li&gt;It would reduce load on the origin server&lt;/li&gt;
	&lt;li&gt;Faster access if user downloads pages from a server closer to them&lt;/li&gt;
	&lt;li&gt;Since load on origin server is low, faster access even if cache needs to be refreshed&lt;/li&gt;
&lt;/ul&gt;
Some major portions of the CDN I am looking to implement
&lt;ol&gt;
	&lt;li&gt;&lt;strong&gt;Origin Server(s)&lt;/strong&gt;&lt;/li&gt;
	&lt;li&gt;&lt;strong&gt;Geo targeting DNS servers&lt;/strong&gt;&lt;/li&gt;
	&lt;li&gt;&lt;strong&gt;Squid Cache&lt;/strong&gt; - Set as Reverse Proxy or web accelerator&lt;/li&gt;
&lt;/ol&gt;
&lt;!--more--&gt;&lt;strong&gt;Origin Server&lt;/strong&gt; : This at the moment is a single server, which may be increased to run mysql and apache on separate boxes to increase productivity. This is up and running and in production.

&lt;strong&gt;Geo targeting DNS servers&lt;/strong&gt; : A perl script making use of Geo::IP and Net::DNS::Nameserver modules to resolve the query based on the origin country of the requester. The DNS script is in very early development. At the moment it is basically the example usage of Net::DNS::Nameserver with the Geo::IP loosely implemented. Need to implement some way of using config files which flush every 10 minutes, so I can use a series of servers runing this script and changes in config can be done on one server and rsynced across all nameservers running this script. The perl script is attached in the end. It would resolve foo.example.com differently if the request came from Malaysia.
&lt;strong&gt;
Squid Cache&lt;/strong&gt; : Squid cache is an Free proxy server which can be setup as a Reverse proxy. Users would query this proxy for pages and the proxy would deliver content, flushing the cache based on the rules defined in the squid.conf file and/or the expires headers tag set by the origin server. It can be setup such that different filetypes are cached in a different manner. Different url patterns need to be cached differently. Queries to some URL patterns by logged-in(based on cookies) users should be direct from origin server. These configurations are a little complicated. My plan for this configuration is attached in the end.

The Geo Dns and Squid would be installed on cheap VPS in a few countries. Will start with one to see how well it scales.

EDIT 1 : Playing with &lt;a href=&#34;http://varnish.projects.linpro.no/&#34;&gt;Varnish&lt;/a&gt; at the moment, considering it over squid.

The Geo Dns perl script :
&lt;pre lang=&#34;perl&#34;&gt;#!/usr/bin/perl

use Geo::IP;
use Net::DNS::Nameserver;
use strict;
use warnings;

sub reply_handler {
my ($qname, $qclass, $qtype, $peerhost,$query) = @_;
my ($rcode, @ans, @auth, @add);

my $gi = Geo::IP-&amp;gt;new(GEOIP_STANDARD);
print &#34;Received query from $peerhost\n&#34;;
my $ip =  substr $peerhost, 7;
my $country = $gi-&amp;gt;country_code_by_addr($ip);
print &#34;--$ip--$country \n\n&#34;;
$query-&amp;gt;print;

if ($qtype eq &#34;A&#34; &amp;amp;&amp;amp; $qname eq &#34;foo.example.com&#34; ) {
my ($ttl, $rdata) = (3600, &#34;10.1.2.3&#34;);
if ($country eq &#34;MY&#34; ) {
$rdata = &#34;10.1.2.4&#34;;
}
push @ans, Net::DNS::RR-&amp;gt;new(&#34;$qname $ttl $qclass $qtype $rdata&#34;);
$rcode = &#34;NOERROR&#34;;
}elsif( $qname eq &#34;foo.example.com&#34; ) {
$rcode = &#34;NOERROR&#34;;

}else{
$rcode = &#34;NXDOMAIN&#34;;
}

# mark the answer as authoritive (by setting the &#39;aa&#39; flag
return ($rcode, \@ans, \@auth, \@add, { aa =&amp;gt; 1 });
}

my $ns = Net::DNS::Nameserver-&amp;gt;new(
LocalPort    =&amp;gt; 53,
ReplyHandler =&amp;gt; \&amp;amp;reply_handler,

Verbose      =&amp;gt; 1,
) || die &#34;couldn&#39;t create nameserver object\n&#34;;

$ns-&amp;gt;main_loop;&lt;/pre&gt;
My idea for squid.conf :
&lt;pre lang=&#34;html&#34;&gt;1) Forward proxy :-

Allow following IPs to browse any website without any caching... allow https also...

a.b.c.d
w.x.y.z
127.0.0.1 (ill do a ssh tunnel)

2) Reverse proxy :-

Rules (to be followed serially, if rule 3 and 5 both match, rule 3 should be used):-

1) All urls ending in the following must be cached for minimum 5 days or expires headder. dont even check to see if file has updated.

.jpg, .gif, .css, .js, .swf, .png  (not case sensitive )

2) POST should never be cached

3) Few URLs should be cached for 30 mins (minimum/maximum) no matter what the expires headder says.

http://www.mysite.com/urla/
http://www.mysite.com/urlc.html
etc...

4) Requests to http://www.mysite.com/sectiona/* :-

* If user has following cookies pass them direct hint : &#34;acl cookie_test req_header Cookie ﻿^.*(comment_author_|wordpress|wp-postpass_).*$&#34;
* http://www.mysite.com/sectiona/sub-section1/* : 30 mins cache no matter what!
* If requester is Googlebot : serve from cache only if it the copy in cache is 5 mins old. else update the cache.
* for other users cache urls ending in .html for 60 mins , rest for 20 mins

5) Requests to http://www.mysite.com/sectionb/*

* no cache unless images.
* Allow access only if user has a particular cookie e.g. secret_word=another_word

6) urls which are NOT in point 4 or 5 :-

* If users have cookie eg. no_cache then pass direct
* 5 min cache for http://www.mysite.com/sectionc/*
* Cache the shit out of everything else for 30 mins

Special Instructions : If origin server is unreachable then show cached result, no matter what. The first cache server is a VPS running ubuntu server with 128 megs of dedicated non-burstable ram and has 4.3 GB diskspace left. resources can be upgraded on request. Where I have mentioned &#34;no matter what&#34; i dont want the proxy server bothering the origin server at all. The origin and proxies will be located far geographically so connection between them may not be optimal.

In case squid allows for URL rewriting, i would like to also map for example :-
us.mysite.com -&amp;gt; www.mysite.com

so if user can access the same stuff by going to www.mysite.com or even us.mysite.com

Also if URL rewriting is possible in Squid, in the future id like to be able to map ... http://www.mysite.com/subfolder as http://somesite.com/subfolder and http://www.mysite.com/anotherfolder as http://anothersite.com/anotherfolder

Also.. if squid supports ssl, would it be possible to use https (and also install some certificate on the squid) then users connection to and from the proxy is encrypted if needed, but the connection between squid and origin server is plaintext ?&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>